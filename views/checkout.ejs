<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title><%= locals.title   %></title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/static/assets/imgs/theme/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Template CSS -->
    <link rel="stylesheet" href="/static/assets/css/main.css">
</head>

<body>
    <header class="header-area header-style-1 header-height-2">
        <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info">
                            <ul>
                                <li><i class="fi-rs-smartphone"></i> <a href="#">(+91)9562978458</a></li>
                                <li><i class="fi-rs-marker"></i><a  href="#">KOCHI</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info header-info-right">
                            <ul>
                                <% if(user){ %>
                                <li><i class="fi-rs-user"></i><a href="/logout">Logout</a></li>
                                <% }else{ %>
                                    <li><i class="fi-rs-user"></i><a href="/login">Log In</a></li>
                                <% } %>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="header-wrap">
                    <div class="logo logo-width-1">
                        <a href="/"><img src="/static/logo/mainlogo.png" alt="logo" style="min-width: 74px;"></a>
                    </div>
                    <div class="header-right">
                        <div class="search-style-2">
                            <form action="/search">
                                <input type="text" placeholder="Search for items..." name="q" >
                            </form>
                        </div>
                        <div class="header-action-right">
                            <div class="header-action-2">
                                <div class="header-action-icon-2">
                                    <a class="mini-cart-icon" href="/wishlist">
                                        <img class="svgInject" alt="Evara" src="/static/assets/imgs/theme/icons/icon-heart.svg">
                                    </a>
                                </div>
                                <div class="header-action-icon-2">
                                    <a class="mini-cart-icon" href="/cart">
                                        <img alt="Evara" src="/static/assets/imgs/theme/icons/icon-cart.svg">
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom header-bottom-bg-color sticky-bar">
            <div class="container">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo logo-width-1 d-block d-lg-none">
                        <a href="index.html"><img src="/static/assets/imgs/theme/logo.svg" alt="logo"></a>
                    </div>
                    <div class="header-nav d-none d-lg-flex">
                        <div class="main-categori-wrap d-none d-lg-block">
                            <a class="categori-button-active" href="#">
                                <span class="fi-rs-apps"></span> Mobile Hub
                            </a>
                        </div>
                        <div class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block">
                            <nav>
                                <ul>
                                    <li><a href="/">Home</i></a>
                                    <li><a href="/shop">Shop</i></a></li>
                                    <li class="position-static"><a href="/profile">My Profile</i></a></li>
                                    <li><a href="/wallet">Wallet</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <div class="hotline d-none d-lg-block">
                        <p><i class="fi-rs-headset"></i><span>Contact</span> 1900 - 888 </p>
                    </div>
                    <p class="mobile-promotion">Happy <span class="text-brand">Mother's Day</span>. Big Sale Up to 40%</p>
                    <div class="header-action-right d-block d-lg-none">
                        <div class="header-action-2">
                            <a href="/login">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                                  </svg>
                                <span class="pro-count white">4</span>
                            </a>
                            <div class="header-action-icon-2">
                                <a href="/wishlist">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                                      </svg>
                                    <span class="pro-count white">4</span>
                                </a>
                            </div>
                            <div class="header-action-icon-2">
                                <a class="mini-cart-icon" href="shop-cart.html">
                                    <img alt="Evara" src="/static/assets/imgs/theme/icons/icon-cart.svg">
                                    <span class="pro-count white">2</span>
                                </a>
                            </div>
                            <div class="header-action-icon-2 d-block d-lg-none">
                                <div class="burger-icon burger-icon-white">
                                    <span class="burger-icon-top"></span>
                                    <span class="burger-icon-mid"></span>
                                    <span class="burger-icon-bottom"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/cart" rel="nofollow">Home</a>
                    <span></span> YourCart
                    <span></span> Checkout
                </div>
            </div>
        </div>
        <section class="mt-50 mb-50">
            <form action="/placeorder" method="POST" id="orderForm" >    
                <div class="container">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="toggle_info">
                                <span><i class="fi-rs-label mr-10"></i><span class="text-muted">Have a coupon?</span> <a href="#coupon" data-bs-toggle="collapse" class="collapsed" aria-expanded="false">Click here to enter your code</a></span>
                            </div>
                            <div class="panel-collapse collapse coupon_form " id="coupon">
                                <div class="panel-body">
                                    <% if (coupon.length > 0) { %>
                                    <p class="mb-30 font-sm">Available Coupons. Please Copy and Paste in the mentioned Box. </p>
                                    <% coupon.forEach(row => { %>
                                        <ul><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-right" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708"/>
                                            <path fill-rule="evenodd" d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708"/>
                                        </svg> <%= row.coupon %> <br>*<%= row.description%> </ul><br><br>
                                        <% }) %> <hr>
                                        
                                        <p class="mb-30 font-sm">If you have a coupon code, Please apply it below.</p>
                                        <div class="form-group">
                                            <input type="text" name="coupon" id="couponInput" placeholder="Enter Coupon Code...">
                                        </div>
                                        <p id="couponApplied"></p>
                                        <div class="form-group">
                                            <button class="btn btn-md" id="applyCouponBtn" >Apply Coupon</button>
                                        </div>
                                    <% } else { %>
                                        <p class="text-danger" >*Coupons not available right now.</p>
                                    <% } %>
                                </div>
                            </div>
                        </div> 
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="divider mt-50 mb-50"></div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <a href="/addaddress"  class="btn btn-fill-out" >Add New Address </a> <br><br>   
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="row">                                    
                                <% if (addresses && addresses.length > 0) { %>
                                    <% addresses.forEach((address, index) => { %>
                                        <div class="col-lg-6">
                                            <input class="form-check-input" required="" type="radio" name="addressId" value="<%= address._id %>" <% if (index === 0) { %>checked<% } %>>
                                            <div class="card mb-3 mb-lg-0" style="width: 80%;">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Address <%= index+1 %> </h5>
                                                </div>
                                                <div class="card-body">
                                                    <address>
                                                        <%= address.buildingname %><br>
                                                        <%= address.city %>,<br>
                                                        <%= address.state %><br>
                                                        <%= address.pincode %>, 
                                                    </address>
                                                    <p><%= address.country %></p>
                                                    <br>
                                                    <a href="/address/edit/<%= address._id %>" class="btn-small">Edit Address</a><br>
                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                    <% }); %>
                                <% } else { %>
                                    <p>No addresses found.</p>
                                <% } %>
                            </div>
                        </div>    
                        <div class="col-md-6">
                            <div class="order_review">
                                <div class="mb-20">
                                    <h4>Your Orders</h4>
                                </div>
                                <div class="table-responsive order_table text-center">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th colspan="2">Product</th>
                                                <th>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% userCart.items.forEach((row)=>{ %>
                                            <tr>
                                                <td class="image product-thumbnail"><img src="static/<%= row.product.images[0] %>" alt="#"></td>
                                                <td>
                                                    <h5><a href="/productdetials/<%= row.product._id %>"><%= row.product.productname %></a></h5> <span class="product-qty">x <%= row.quantity %></span>
                                                </td>
                                                <td>₹ <%= row.product.newprice * row.quantity %> </td>
                                            </tr>
                                            <% }) %>
                                            <tr>
                                                <th>SubTotal</th>
                                                <td class="product-subtotal" colspan="2"  >₹ <%= userCart.totalprice %> </td>
                                            </tr>
                                            <tr>
                                                <th>Discount</th>
                                                <td class="product-subtotal" colspan="2" id="couponId"  >₹ 0 </td>
                                            </tr>
                                            <tr>
                                                <th>Shipping</th>
                                                <td colspan="2"><em>Free Shipping</em></td>
                                            </tr>
                                            <tr>
                                                <th>Total</th>
                                                <td colspan="2" class="product-subtotal" id="subtotal"  ><span class="font-xl text-brand fw-900"  >₹ <%= userCart.totalprice %> </span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p id="coupondetails"></p>
                                <p id="CancelBtn"></p>
                                <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                <div class="payment_method">
                                    <div class="mb-25"> 
                                        <h5>Payment</h5>
                                    </div>
                                    <div class="payment_option">                                    
                                        <div class="checkout_input_checkbox">
                                            <label for="payment-cod">
                                            COD
                                            <input style="width: 16px; height: 14px;" type="checkbox" id="payment-cod" name="paymentMethod" value="COD" checked />
                                            <span class="checkmark"></span>
                                            </label>
                                        </div>
                                        <div class="checkout_input_checkbox">
                                            <label for="payment-razorpay">
                                            Razorpay
                                            <input style="width: 16px; height: 14px;" type="checkbox" id="payment-razorpay" name="paymentMethod" value="Razorpay" />
                                            <span class="checkmark"></span>
                                            <span id="check-error" style="font-size: 14px; margin-top: -5px"></span>
                                            </label>
                                        </div>                      
                                        <div class="checkout_input_checkbox">
                                            <label for="payment-wallet">
                                            Wallet
                                            <input style="width: 16px; height: 14px;" type="checkbox" id="payment-wallet" name="paymentMethod" value="Wallet" />
                                            <span class="checkmark"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <% if (addresses && addresses.length > 0) { %>
                                    <button type="submit" class="btn btn-fill-out btn-block mt-30">Place Order</button>
                                <% } else { %>
                                    <button type="submit" class="btn btn-fill-out btn-block mt-30" disabled>Place Order</button>
                                    <div>
                                        <span style="color: red;">Add or select an address to place an order</span>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" name="cartItem" value='<%= JSON.stringify(userCart.items) %>'>
                    <input type="hidden" name="orderId" value="<%= userCart._id%>">
                    <input type="hidden" id="paymentStatus" name="paymentStatus">
                    <input type="hidden" name="totalprice" id="subtotalInp" value="<%= userCart.totalprice %>" >
                    <input type="hidden" id="discountId" name="discount" >
                </div>
            </form> 
        </section>
        </main>
        <footer class="main">
            <section class="newsletter p-30 text-white wow fadeIn animated" style="background-color: #39b4ac;">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-7 mb-md-3 mb-lg-0" style="background-color: #39b4ac;">
                        </div>
                    </div>
                </div>
            </section>
            <section class="section-padding footer-mid">
                <div class="container pt-15 pb-20">
                    <div class="row">
                        <div class="col-lg-4 col-md-6">
                            <div class="widget-about font-md mb-md-5 mb-lg-0">
                                <div class="logo logo-width-1 wow fadeIn animated">
                                    <a href="index.html"><img src="/static/logo/mainlogo.png" alt="logo"></a>
                                </div>
                                <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                                <p class="wow fadeIn animated">
                                    <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                                </p>
                                <p class="wow fadeIn animated">
                                    <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                                </p>
                                <p class="wow fadeIn animated">
                                    <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                                </p>
                                <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                                <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                                    <a href="#"><img src="/static/assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                                    <a href="#"><img src="/static/assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                    <a href="#"><img src="/static/assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                                    <a href="#"><img src="/static/assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                                    <a href="#"><img src="/static/assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-3">
                            <h5 class="widget-title wow fadeIn animated">About</h5>
                            <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                                <li><a href="#">About Us</a></li>
                                <li><a href="#">Delivery Information</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                                <li><a href="#">Terms &amp; Conditions</a></li>
                                <li><a href="#">Contact Us</a></li>
                                <li><a href="#">Support Center</a></li>
                            </ul>
                        </div>
                        <div class="col-lg-2  col-md-3">
                            <h5 class="widget-title wow fadeIn animated">My Account</h5>
                            <ul class="footer-list wow fadeIn animated">
                                <li><a href="#">Sign In</a></li>
                                <li><a href="#">View Cart</a></li>
                                <li><a href="#">My Wishlist</a></li>
                                <li><a href="#">Track My Order</a></li>
                                <li><a href="#">Help</a></li>
                                <li><a href="#">Order</a></li>
                            </ul>
                        </div>
                        <div class="col-lg-4">
                            <h5 class="widget-title wow fadeIn animated">Install App</h5>
                            <div class="row">
                                <div class="col-md-8 col-lg-12">
                                    <p class="wow fadeIn animated">From App Store or Google Play</p>
                                    <div class="download-app wow fadeIn animated">
                                        <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active" src="/static/assets/imgs/theme/app-store.jpg" alt=""></a>
                                        <a href="#" class="hover-up"><img src="/static/assets/imgs/theme/google-play.jpg" alt=""></a>
                                    </div>
                                </div>
                                <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                                    <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                                    <img class="wow fadeIn animated" src="/static/assets/imgs/theme/payment-method.png" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Vendor JS-->
    <script src="/static/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="/static/assets/js/vendor/bootstrap.bundle.min.js"></script>


    <!-- Template  JS -->
    <script src="/static/assets/js/main.js"></script>
    <script src="/static/assets/js/shop.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="/static/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        var checkError = document.getElementById("check-error");
      
        function validateForm() {
        const paymentCODCheckbox = document.getElementById("payment-cod");
        const paymentRazorpayCheckbox = document.getElementById("payment-razorpay");
        const paymentWalletCheckbox = document.getElementById("payment-wallet");
        const paymentStatusInput = document.getElementById("paymentStatus");
        const checkedCount = [paymentCODCheckbox, paymentRazorpayCheckbox, paymentWalletCheckbox].filter(checkbox => checkbox.checked).length;
      
        const totalPriceInput = document.getElementById("subtotalInp");
        const totalPrice = parseFloat(totalPriceInput.value)

        if (checkedCount !== 1) {
          checkError.style.display = "block";
          checkError.innerHTML = "Please select only one payment method";
          checkError.style.color = "red";
          setTimeout(function () {
            checkError.style.display = "none";
          }, 3000);
          return false;
        }
        else if (totalPrice > 30000 && paymentCODCheckbox.checked) {
          paymentStatusInput.value = "Pending";
          checkError.style.display = "block";
          checkError.innerHTML = "COD is not available for orders above Rs 30000.";
          checkError.style.color = "red";
          setTimeout(function () {
            checkError.style.display = "none";
          }, 3000);
          return false;
        }
         else if (!paymentCODCheckbox.checked && !paymentRazorpayCheckbox.checked && !paymentWalletCheckbox.checked) {
          checkError.style.display = "block";
          checkError.innerHTML = "Please select a payment method";
          checkError.style.color = "red";
          setTimeout(function () {
            checkError.style.display = "none";
          }, 3000);
          return false;
        }  else if (paymentRazorpayCheckbox.checked) {
          initiateRazorpayPayment();
          return false;

          } else if (paymentCODCheckbox.checked) {
            document.getElementById('paymentStatus').value = 'Pending';
            paymentStatusInput.value = "Pending";
            Swal.fire({
              title: "Are you sure?",
              text: "Do you want to place the order?",
              icon: "question",
              showCancelButton: true,
              confirmButtonColor: "#3085d6",
              cancelButtonColor: "#d33",
              confirmButtonText: "Yes, place order",
            }).then((result) => {
              if (result.isConfirmed) {
                console.log("Order placed");
                document.getElementById("orderForm").submit();
              }
            });
            return false;

          }else if (paymentWalletCheckbox.checked) {
            fetch('/check-wallet-balance', {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ totalPrice: totalPrice })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const walletBalance = data.balance;
                    if (totalPrice <= walletBalance) {
                        Swal.fire({
                            title: "Are you sure?",
                            text: "Do you want to place the order?",
                            icon: "question",
                            showCancelButton: true,
                            confirmButtonColor: "#3085d6",
                            cancelButtonColor: "#d33",
                            confirmButtonText: "Yes, place order",
                        }).then((result) => {
                            if (result.isConfirmed) {
                                console.log('hjhh');
                                console.log("Order placed");
                                // Submit the order form
                                document.getElementById('paymentStatus').value = 'Paid';
                                document.getElementById("orderForm").submit();
                            }
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Insufficient Wallet Balance',
                            text: 'Your wallet balance is not sufficient to complete the transaction.',
                            showConfirmButton: true
                        });
                    }
                } else {
                    Swal.fire({
                        icon: 'error',
                            title: 'Insufficient Wallet Balance',
                            text: 'Your wallet balance is not sufficient to complete the transaction.',
                            showConfirmButton: true
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });

            return false; 
          }
        }
      
        document.getElementById("orderForm").addEventListener("submit", function (event) {
       event.preventDefault();
       validateForm();
       // Additional logic if needed
    });
        
      
        function initiateRazorpayPayment() {
          const user = {
            name: "<%= userData.name %>",
            email: "<%= userData.email %>",
            phone: "<%= userData.phone %>",
          };
         
          const totalPriceInput = document.getElementById("subtotalInp").value
          const totalPrice = parseFloat (totalPriceInput)

      
          var options = {
            key: "rzp_test_GRK2fo2RAm4Wol",
            amount: totalPrice * 100,
            currency: "INR",
            name: "Mobile Hub",
            description: "Purchase Description",
            image: "https://example.com/logo.png",
            
            handler: function (response) {
              console.log(response);
                console.log("Payment successful");
                document.getElementById('paymentStatus').value = 'Paid';
             
              submitForm();
            },


      
            prefill: {
              name: user.name,
              email: user.email,
              contact: user.phone,
            },
            theme: {
              color: "#3399cc",
            },
          };
      
          var rzp = new Razorpay(options);


        rzp.on('payment.error', function(response) {
            console.log("Payment failed");
            document.getElementById('paymentStatus').value = 'Failed';
            submitForm();
        });
        
          rzp.open();
        }
      
        function submitForm() {
          const form = document.getElementById("orderForm");
          form.submit();
        }
    
      </script>

      <script>
        document.addEventListener("DOMContentLoaded", function() {
            const applyCouponBtn = document.getElementById("applyCouponBtn");
        

            applyCouponBtn.addEventListener("click", function(event) {
                event.preventDefault();
                const couponCode = document.getElementById("couponInput").value;
                applycoupon(couponCode);

        })
            async function applycoupon(couponCode) {
                const response = await fetch('/couponcheck',{
                    method: 'post',
                    headers: { 'content-type' : 'application/json' },
                    body: JSON.stringify({ couponCode })
                })
                
                const data = await response.json();

                if (response.ok) {
                    const newTotalPrice = data.totalAmount;

                    document.getElementById('subtotal').innerText = `₹ ${newTotalPrice}` ;
                    document.getElementById('subtotalInp').value = newTotalPrice;
                    document.getElementById('coupondetails').innerHTML = `<p class="text-success">* Coupon Applied</p>`;
                    document.getElementById('couponId').innerHTML = `₹ ${data.discountAmount}`;
                    document.getElementById('discountId').value = data.discountAmount
                    document.getElementById('couponApplied').innerHTML = `<p class="text-success">* Coupon Applied</p>`;
                    document.getElementById('CancelBtn').innerHTML = `<a onclick="cancelCoupon()" href="#" class="text-danger" id="CancelBtn" >Cancel Coupon</a>`;
                } else {
                    
                    document.getElementById('couponApplied').innerHTML = `<p class=" text-danger">*${data.message}</p>`
                    window.location.reload()
                }

            

            }
        })
                function cancelCoupon(){
                    window.location.reload()
                }
      </script>
</body>


</html>